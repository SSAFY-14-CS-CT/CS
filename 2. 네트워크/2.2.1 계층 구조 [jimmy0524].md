# 2.2.1 계층 구조

<img width="375" height="345" alt="image" src="https://github.com/user-attachments/assets/52d82719-782b-473d-b500-51beaf127ebc" />

## 애플리케이션 계층

FTP SSH HTTP SSH SMTP DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층이다.

- **대표 프로토콜**
    - **FTP**: 파일 전송
    - **SSH**: 원격 접속, 보안 터미널
    - **HTTP/HTTPS**: 웹 서비스 통신
    - **SMTP**: 이메일 발송
    - **DNS**: 도메인 이름 ↔ IP 주소 변환

## 전송계층

송신자와 수신자 간의 **신뢰성 있는 데이터 전송** 보장

- **기능**:
    - 연결 관리
    - 흐름 제어
    - 오류 검출 및 재전송
    - 포트 번호 기반 다중화

### TCP

- **순서 보장**
- **신뢰성 보장** (ACK 응답, 재전송)
- **가상회선 패킷 교환 방식**
    - 모든 패킷에 가상회선 ID를 포함하여 **순서대로 도착**
    - 예: 화상회의, 파일 전송

### TCP 연결 과정

3 way hanshake

<img width="610" height="587" alt="image" src="https://github.com/user-attachments/assets/2d2976a6-4f33-4c09-bce7-8dce5d50b6ce" />

- **SYN**: 클라이언트 → 서버 연결 요청
- **SYN + ACK**: 서버 → 클라이언트 응답 + 연결 승인
- **ACK**: 클라이언트 → 서버 최종 승인

### TCP 연결 해제 과정

<img width="458" height="355" alt="image" src="https://github.com/user-attachments/assets/1414cc31-f452-4c2d-b3ac-b2f98455a0da" />

1. FIN
2. ACK
3. FIN
4. ACK

### UDP

- 순서 보장 x
- 수신 여부 확인  x
- 데이터그램 패킷 교환 방식
    - 독립적으로 이동하며 최적의 경로를 선택해서 가는데 하나의 메세지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있으며 순서가 다를 수 있는 방식

## 인터넷 계층

장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층

- **대표 프로토콜**
    - **IP**: 논리적 주소 지정 (IPv4, IPv6)
    - **ARP**: IP ↔ MAC 주소 변환
    - **ICMP**: 네트워크 상태 확인 (ping)
- **특징**:
    - 비연결형 (연결 상태 유지 ❌)
    - 순서·신뢰성 보장 ❌ (전송 계층에서 처리) - 인터넷 계층은 순서·신뢰성을 보장하지 않지만, 필요하다면 전송 계층에서 그걸 보장한다

## 링크 계층

실질적으로 데이터를 전달하고, 장치 간에 신호를 주고받는 ‘규칙’을 정하는 계층

**구성**

- **물리 계층**: 전송 매체, 케이블, 무선 신호
- **데이터 링크 계층**: MAC 주소 기반 통신, 프레임 단위 전송

### 전이중화 통신

양쪽 장치가 동시에 송수신할 수 있는 방식을 말함

- **구조**: 송신로와 수신로를 물리적으로 분리
- **장점**:
    - 데이터 충돌(콜리전) 발생 ❌
    - 속도 빠름 (전송로가 분리되어 있으니까)
- **예시**:
    - 현대 유선 LAN (스위치 기반 이더넷)
    - 전화 통화

### 반이중화 통신

양쪽 장치는 서로 통신할 수 있지만, 동시에는 통신할 수 없으며 한 방향만 통신할 수 있는 방식

- **구조**: 송신/수신로가 물리적으로 하나라서 번갈아 사용
- **단점**:
    - 동시에 말하면 충돌 발생 (무전기 같은 상황)
    - 충돌 감지/방지 기술 필요
- **예시**:
    - 무전기
    - 일부 무선 네트워크
- **특징**:
    - 유선일 경우 **CSMA/CD** 사용
        - 유선 LAN(예: 이더넷) 환경에서는 케이블을 통해 신호가 전달되기 때문에, 충돌이 발생했을 때 신호의 변화를 **감지**하는 것이 상대적으로 쉽다. 두 장치가 동시에 데이터를 보내면 전압이 평소보다 높아지는 등의 물리적인 변화를 감지할 수 있다.
    - 무선일 경우 **CSMA/CA** 사용
        - 무선 LAN(Wi-Fi) 환경에서는 전파를 통해 신호가 전달되므로, 충돌이 발생해도 이를 감지하기가 매우 어렵다. 장치는 자신이 보낸 신호가 다른 장치의 신호와 충돌했는지 확인할 수 없기 때문이다. 따라서, 충돌이 발생하기 전에 미리 **충돌을 방지**하는 것이 더 효율적이다.
- CSMA/CD

데이터를 보낸 이후 충돌이 발생한다면 일정 시간 이후 재전송하는 방식

한 경로로 데이터를 보내기 때문에 데이터를 보낼 때 충돌에 대해 대비해야 했기 때문이다.

- CSMA/CA

반이중화 통신 중 하나로 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식을 사용함

- 데이터를 송신하기 전에 무선 매체 살핌
- 캐리어 감지: 회선이 비어 있는지를 판단함
- IFS : 랜덤 값을 기반으로 정해진 시간만큼 기다림
- 이러한 과정들을 거친 후에 데이터를 송신함

### 와이파이

전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술로

공유기가 필요함 (AP Access Point) 이를 통해 유선 LAN 에 흐르는 신호 → 무선 LAN 신호로 바꿔줌

### BSS

기본 서비스 집합을 의미하며, 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조

근거리 무선 통신 제공

하나의 AP만(동일 BSS내에 있는 AP들이 뭘까 하나의 AP라면서 왜 AP들이라고 뒤에 설명을 했지)???을 기반으로 구축되어있어 사용자의 자유로운 이동 및 접속이 불가능

### ESS

하나 이상의 연결된 BSS 그룹이다. 장거리 무선 통신을 제공하며 BSS보다 더 많은 가용성과 이동성을 지원한다. 즉, 사용ㅎ자는 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크 연결 가능

## 계층 간 데이터 송수신 과정

<img width="460" height="406" alt="image" src="https://github.com/user-attachments/assets/7aeade53-193a-4d90-9fc8-22f2dad163a3" />

### 캡슐화 과정

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함 + 해당 계층의 헤더를 삽입하는 과정

### 비캡슐화 과정

하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정을 말함